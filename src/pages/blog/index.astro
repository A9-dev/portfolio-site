---
import WorklogPost from "../../components/WorklogPost.astro";
import BaseLayout from "../../components/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

const posts: CollectionEntry<"blog">[] = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

type PostsByDate = Record<string, CollectionEntry<"blog">[]>;

const postsByDate = posts.reduce((acc, post) => {
  const date = post.data.pubDate.toISOString().split("T")[0];
  if (!acc[date]) {
    acc[date] = [];
  }
  acc[date].push(post);
  return acc;
}, {} as PostsByDate);
---

<BaseLayout title="Blog">
  <h1 class="text-6xl font-bold">Progression Log</h1>
  <div class="mt-8 max-w-2xl mx-auto px-4">
    {
      // All the errors in this section will now be resolved
      Object.entries(postsByDate).map(([date, posts]) => (
        <div class="mb-8">
          <h2 class="text-2xl font-bold mb-4">{date}</h2>
          {posts.map((post, index) => (
            <>
              <a
                href={`/blog/${post.id}`}
                class="block rounded-lg hover:bg-slate-400/50 transition-colors px-4 py-2"
              >
                <WorklogPost post={post} />
              </a>
              {index !== posts.length - 1 && (
                <hr class="my-2 border-slate-300" />
              )}
            </>
          ))}
        </div>
      ))
    }
  </div>
</BaseLayout>
